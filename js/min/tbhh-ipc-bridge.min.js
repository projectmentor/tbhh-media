/* tbhh-ipc-bridge.js - Minified 2025-09-15_222232 */
(()=>{const e=window;if(e.__TBHH_IPC_BRIDGE_VER__)return;e.__TBHH_IPC_BRIDGE_VER__="1.0";const t=!0,r=location.host;e.TBHH_EXPOSE=e.TBHH_EXPOSE||Object.create(null);const n=()=>{const t=e.tbhhConfig,r=t&&(t.VERSION||t.version||t.versionTag||t.timestamp||t.meta&&(t.meta.version||t.meta.build))||null,n=t&&(t.cdnBase||t.cdn&&(t.cdn.base||t.cdn.url)||t.cdn)||null,s={has:!!t,ready:!(!t||!0!==t.ready),version:r,cdn:n};return e.TBHH_HEALTH=s,s},s=(t,r)=>({tbhh:1,type:"RES",id:t,ok:!0,result:r,bridge:{ver:e.__TBHH_IPC_BRIDGE_VER__}}),o=(t,r)=>({tbhh:1,type:"RES",id:t,ok:!1,error:String(r||"error"),bridge:{ver:e.__TBHH_IPC_BRIDGE_VER__}}),a=(e,t,r)=>{try{if(r)return r.postMessage(t),!0;if(e&&e.postMessage)return e.postMessage(t,"*"),!0}catch{}return!1},c=new Set,i=async i=>{const _=i&&i.data;if(!_||1!==_.tbhh||"REQ"!==_.type)return;if(!(e=>{if(!e)return t;try{if("null"===e)return!0;const t=new URL(e);if(t.host===r)return!0;if(/\.googletagmanager\.com$/i.test(t.host))return!0}catch{}return!1})(i.origin))return;const u=i.ports&&i.ports[0]||null,l=_.id;try{switch(_.action){case"health":return a(i.source,s(l,n()),u);case"config":{const t=e.tbhhConfig,r=t?{ready:!!t.ready,version:t.VERSION||t.version||t.versionTag||t.timestamp||t.meta&&(t.meta.version||t.meta.build)||null,cdn:t.cdnBase||t.cdn&&(t.cdn.base||t.cdn.url)||t.cdn||null}:null;return a(i.source,s(l,r),u)}case"call":{const t=Array.isArray(_.path)?_.path:String(_.path||"").split(".").filter(Boolean);let r=e.TBHH_EXPOSE;for(const e of t)r=r&&r[e];if("function"==typeof r){const t=await Promise.resolve(r.apply(e.TBHH_EXPOSE,Array.isArray(_.args)?_.args:[]));return a(i.source,s(l,t),u)}return a(i.source,s(l,r),u)}case"subscribe":return u&&(e=>{if(e){c.add(e);try{e.onmessage=t=>{if(t&&"UNSUB"===t.data){c.delete(e);try{e.close()}catch{}}}}catch{}}})(u),a(i.source,s(l,{subscribed:"health"}),u);case"unsubscribe":return u&&c.delete(u),a(i.source,s(l,{unsubscribed:!0}),u);default:return a(i.source,o(l,"unknown action"),u)}}catch(e){return a(i.source,o(l,e&&e.message),u)}};e.addEventListener("message",i,!0),e.addEventListener("message",i,!1);let _="";const u=()=>{const t=n(),r=JSON.stringify(t);r!==_&&(_=r,(e=>{for(const t of[...c])try{t.postMessage(e)}catch{c.delete(t)}})({tbhh:1,type:"EVENT",event:"health",data:t,bridge:{ver:e.__TBHH_IPC_BRIDGE_VER__}})),setTimeout(u,t&&t.ready?2500:500)};u();try{const t=e.console&&e.console.log;t&&!e.__TBHH_IPC_CONSOLE_SHIM__&&(e.__TBHH_IPC_CONSOLE_SHIM__=!0,e.console.log=function(...e){try{const t=e[0];"string"==typeof t&&-1!==t.indexOf("[TBHH Loader]")&&n()}catch{}return t.apply(this,e)})}catch{}e.TBHH_IPC=Object.freeze({ver:e.__TBHH_IPC_BRIDGE_VER__,health:()=>n(),subscriptions:()=>c.size})})();