/* tbhh-broker-info.js - Minified 2025-09-15_163208 */
{window.tbhhBrokerInfo=window.tbhhBrokerInfo||{};const o="[TBHH BrokerInfo]";let n=null;window.tbhhBrokerInfo.detectSubdomain=()=>{const o=window.location.hostname.split(".");return o.length>2?{isSubdomain:!0,subdomain:o[0]}:{isSubdomain:!1,subdomain:null}},window.tbhhBrokerInfo.getBrokerInfo=()=>{const n=window.tbhhConfig.CDN_BASE_MEDIA,i=window.tbhhConfig,e=i.AGENT_CONFIG,r=i.BROKER_CONFIG;if(!e||!e.domains)throw console.error(`${o} Missing AGENT_CONFIG.domains in configuration`),new Error("Invalid agent configuration structure");console.log(`🔍 ${o} Using media CDN base:`,n),console.log(`🔍 ${o} Current hostname:`,window.location.hostname);const t=window.tbhhBrokerInfo.detectSubdomain();let a;if(t.isSubdomain){if(e.domains.subdomains&&e.domains.subdomains[t.subdomain])a=e.domains.subdomains[t.subdomain].agentId;else if(a=e.domains.default?.agentId,!a)throw console.error(`${o} Missing default agentId in configuration`),new Error("Default agent not configured")}else if(a=e.domains.main?.agentId,!a)throw console.error(`${o} Missing agentId for main domain in configuration`),new Error("Main domain agent not configured");const s=e.agents&&e.agents[a];if(!s)throw console.error(`${o} Agent '${a}' not found in configuration`),new Error(`Agent ${a} not configured`);const d=r&&r[s.brokerId];if(!d)throw console.error(`${o} Broker '${s.brokerId}' not found in configuration`),new Error(`Broker ${s.brokerId} not configured`);const l={agentId:s.id||a,name:s.name,phone:s.phone,email:s.email,title:s.title,brokerId:s.brokerId,brokerName:d.name,brokerShortName:d.shortName,logo:d.logo};return{...l,logo:l.logo?`${n}${l.logo}`:null}},window.tbhhBrokerInfo.init=()=>{try{if(!window.tbhhConfig)return console.warn(`${o} Configuration not available. Cannot initialize broker info.`),null;console.log(`✅ ${o} Initializing agent info module...`);const i=window.tbhhConfig;if(!i.AGENT_CONFIG||!i.AGENT_CONFIG.domains)return console.error(`${o} Invalid AGENT_CONFIG structure. Missing domains property.`),null;const e=window.tbhhBrokerInfo.detectSubdomain(),r=window.tbhhBrokerInfo.getBrokerInfo();if(n={isSubdomain:e.isSubdomain,subdomain:e.subdomain,agentId:r.agentId,name:r.name,phone:r.phone,email:r.email,title:r.title,brokerId:r.brokerId,brokerName:r.brokerName,brokerShortName:r.brokerShortName,logo:r.logo},console.log(`✅ ${o} Agent info set:`,r.name,`(${r.brokerName||r.brokerShortName||""})`,e.isSubdomain?`(subdomain: ${e.subdomain})`:"(main domain)"),console.log(`✅ ${o} Agent info module initialized`),window.tbhhAgentBypass&&"function"==typeof window.tbhhAgentBypass.setup&&!window.tbhhAgentBypass.originalOpenSignLog&&"object"==typeof siteAppVm){console.log(`🔄 ${o} Ensuring agent bypass setup runs...`);try{window.tbhhAgentBypass.setup(siteAppVm)}catch(n){console.warn(`${o} Agent bypass setup failed:`,n)}}return n}catch(n){return console.error(`${o} Error initializing broker info:`,n),null}},window.tbhhBrokerInfo.getBrokerData=()=>(n||(n=window.tbhhBrokerInfo.init()),!n&&window.tbhhConfig&&(console.log(`${o} Config now available, retrying initialization...`),n=window.tbhhBrokerInfo.init()),n)}